<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Smörgås Kaffet – Ventas</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    :root{
      --bg-sky: #9fd0ff;           /* Fondo azul suave */
      --panel-yellow: #fff59d;     /* Cabecera amarilla */
      --primary-blue: #1e88e5;     /* Botón “Añadir Cuenta” */
      --warning-orange: #f4a261;   /* Botón “Editar” */
      --danger-red: #e85d5d;       /* Botón “Eliminar” */
      --text-dark: #2b2d2f;
      --table-shadow: 0 8px 24px rgba(0,0,0,.12);
    }

    body{ background: var(--bg-sky); color: var(--text-dark); }

    .board{
      max-width: 980px; margin: 48px auto; background:#fff;
      border-radius: 18px; overflow: hidden;
      box-shadow: var(--table-shadow); border: 2px solid rgba(0,0,0,.06);
    }
    .board__header{ background: var(--panel-yellow); padding: 22px 24px 10px; text-align: center; }
    .board__title{ font-weight: 700; letter-spacing: .5px; margin: 0 0 14px; }

    .btn-primary{
      background: var(--primary-blue); border-color: var(--primary-blue);
      font-weight: 600; border-radius: 10px;
    }
    .btn-primary:hover{ filter: brightness(0.95); }

    .board__body{ padding: 22px 24px 28px; background:#fff; }

    .table{ margin:0; border-collapse: separate; border-spacing:0; }
    .table thead th{ background:#f7f9fc; color:#4a4c50; font-weight:600; border-bottom:2px solid #e9eef6; }
    .table tbody tr + tr td{ border-top:1px solid #eef2f7; }

    .badge-serv{
      font-weight:600; background:#eef6ff; border:1px solid #d7e9ff; color:#215a96;
      border-radius:999px; padding:6px 10px;
    }

    .btn-edit{
      background: var(--warning-orange); border:none; color:#1f2328;
      font-weight:700; padding:.45rem .8rem; border-radius:8px;
    }
    .btn-edit:hover{ filter: brightness(0.95); color:#1f2328; }

    .btn-del{
      background: var(--danger-red); border:none; color:#fff;
      font-weight:700; padding:.45rem .8rem; border-radius:8px;
    }
    .btn-del:hover{ filter: brightness(0.95); color:#fff; }

    .flash-wrap{ max-width:980px; margin:18px auto 0; }
  </style>
</head>
<body>

<!-- Mensajes flash -->
<div class="flash-wrap">
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="alert alert-{{ category }} alert-dismissible fade show shadow-sm" role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Cerrar"></button>
        </div>
      {% endfor %}
    {% endif %}
  {% endwith %}
</div>

<!-- TABLERO PRINCIPAL -->
 <div class="mt-2">
  <span class="text-muted">Usuario: {{ session.nombre_usuario }}</span>
  <a class="btn btn-sm btn-outline-dark ms-2" href="{{ url_for('logout') }}">Cerrar sesión</a>
</div>

<section class="board">
  <div class="board__header">
    <h2 class="board__title">Smörgås Kaffet</h2>

<a class="btn btn-primary px-4" href="{{ url_for('pagina2') }}">Añadir Cuenta</a>
  </div>

  <div class="board__body">
    <div class="table-responsive">
      <table class="table align-middle" id="tablaVentas">
        <thead>
          <tr>
            <th style="width: 90px;">Folio</th>
            <th style="width: 120px;">Mesa</th>
            <th style="width: 140px;">Total</th>
            <th style="width: 160px;">Servicio</th>
            <th style="width: 200px;">Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for v in ventas %}
          <tr>
            <td>#{{ v['id_Folio'] }}</td>
            <td>{{ v['id_mesa'] }}</td>
            <td>${{ '%.2f'|format(v['importe_total']) }}</td>
            <td>
              <span class="badge-serv">
                {{ 'Llevar' if v['id_modo_entrega']==1 else ('Comedor' if v['id_modo_entrega']==2 else v['id_modo_entrega']) }}
              </span>
            </td>
            <td>
              <div class="d-flex gap-2">
                <button
                  type="button"
                  class="btn btn-edit btn-sm edit-btn"
                  data-bs-toggle="modal"
                  data-bs-target="#editModal"
                  data-folio="{{ v['id_Folio'] }}"
                  data-mesa="{{ v['id_mesa'] }}"
                  data-total="{{ v['importe_total'] }}"
                  data-servicio="{{ v['id_modo_entrega'] }}">
                  Editar
                </button>

                <!-- Eliminar: simple confirm y redirección a /delete/<folio> -->
                <a
                  href="{{ url_for('delete', folio=v['id_Folio']) }}"
                  class="btn btn-del btn-sm"
                  onclick="return confirm('¿Eliminar definitivamente el folio #{{ v['id_Folio'] }}?');">
                  Eliminar
                </a>
              </div>
            </td>
          </tr>
          {% else %}
          <tr>
            <td colspan="5" class="text-center text-muted py-4">Sin registros por ahora.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</section>

<!-- Modal Edición -->
<div class="modal fade" id="editModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <form id="editForm" method="POST">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Editar Cuenta</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
        </div>
        <div class="modal-body">
          <div class="mb-2">
            <label class="form-label">Folio</label>
            <input type="text" id="editFolio" class="form-control" disabled>
          </div>
          <div class="mb-2">
            <label class="form-label">Mesa</label>
            <input type="number" id="editMesa" name="id_mesa" class="form-control" required>
          </div>
          <div class="mb-2">
            <label class="form-label">Total</label>
            <input type="number" step="0.01" id="editTotal" name="importe_total" class="form-control" required>
          </div>
          <div class="mb-2">
            <label class="form-label">Servicio</label>
            <select id="editServicio" name="id_modo_entrega" class="form-select" required>
              <option value="1">Llevar</option>
              <option value="2">Comedor</option>
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-primary" type="submit">Guardar</button>
          <button class="btn btn-secondary" type="button" data-bs-dismiss="modal">Cancelar</button>
        </div>
      </div>
    </form>
  </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  // Rellenar modal y setear action
  document.querySelectorAll(".edit-btn").forEach(btn => {
    btn.addEventListener("click", function () {
      const folio = this.dataset.folio;
      const mesa = this.dataset.mesa;
      const total = this.dataset.total;
      const servicio = this.dataset.servicio;

      document.getElementById("editFolio").value = folio || '';
      document.getElementById("editMesa").value = mesa || '';
      document.getElementById("editTotal").value = total || '';
      document.getElementById("editServicio").value = servicio || '1';
      document.getElementById("editForm").action = "/update/" + encodeURIComponent(folio);
    });
  });
</script>
</body>
</html>
